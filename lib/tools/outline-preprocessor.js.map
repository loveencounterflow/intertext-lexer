{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../../src/tools/outline-preprocessor.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n\n\n'use strict'\n\n\n############################################################################################################\nGUY                       = require 'guy'\n{ alert\n  debug\n  help\n  info\n  plain\n  praise\n  urge\n  warn\n  whisper }               = GUY.trm.get_loggers 'INTERLEX/OUTLINE-PREPROC'\n{ rpr\n  inspect\n  echo\n  log     }               = GUY.trm\n{ misfit\n  get_base_types }        = require '../types'\nlets                      = GUY.lft.lets\n{ Transformer\n  transforms\n  $           }           = require 'moonriver'\n{ $window }               = transforms\n{ DATOM }                 = require 'datom'\n{ new_datom\n  select }                = DATOM\n\n\n#===========================================================================================================\n_new_prelexer = ( cfg ) ->\n  { Interlex }  = require '../main'\n  lexer         = new Interlex { split: 'lines', cfg..., }\n  prv_spc_count = 0\n  #.......................................................................................................\n  do =>\n    mode = 'outline'\n    nl = ( token ) => lets token, ( token ) =>\n      token.value           = '\\n'\n      token.data           ?= {}\n      token.data.spc_count  = prv_spc_count\n      return token\n    material = ( token ) => lets token, ( token ) =>\n      token.data           ?= {}\n      token.data.indent    ?= ''\n      token.data.material  ?= ''\n      token.data.spc_count  = prv_spc_count = token.data.indent.length\n      return token\n    ### NOTE consider to allow escaping newlines ###\n    # lexer.add_lexeme { mode, tid: 'escchr',         pattern: /\\\\(?<chr>.)/u,                      reserved: '\\\\', }\n    lexer.add_lexeme { mode, tid: 'nl',       create: nl,       pattern: /$/u, }\n    lexer.add_lexeme { mode, tid: 'material', create: material, pattern: /^(?<indent>\\x20*)(?<material>.+)$/, }\n  #.......................................................................................................\n  return lexer\n\n#===========================================================================================================\n@$010_lexing = class $010_lexing extends Transformer\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ->\n    super()\n    GUY.props.hide @, '_lexer', _new_prelexer()\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  $parse: => parse = ( source, send ) =>\n    for d from @_lexer.walk source\n      send lets d, ( d ) -> d.$ = '^outliner@010^'\n    return null\n\n#===========================================================================================================\n@$020_consolidate = class $020_consolidate extends $010_lexing\n\n  #---------------------------------------------------------------------------------------------------------\n  $consolidate_newlines: ->\n    { Interlex }  = require '../main'\n    position      = null\n    nl_count      = 0\n    spc_count     = null\n    stop          = Symbol 'stop'\n    ref           = '^outliner@020^'\n    #.......................................................................................................\n    flush = ( send ) =>\n      return null if nl_count is 0\n      value         = '\\n'.repeat nl_count\n      position.lnr2 = position.lnr1 + nl_count\n      if nl_count is 1\n        $key          = 'outline:nl'\n      else\n        position.lnr2 = position.lnr1 + nl_count - 1\n        position.x2   = 0\n        $key          = 'outline:nls'\n      data          = { nl_count, spc_count, }\n      nls           = new_datom $key, { value, data, position..., $: ref, }\n      nl_count      = 0\n      position      = null\n      spc_count     = null\n      send nls\n    #.......................................................................................................\n    return $ { stop, }, consolidate_newlines = ( d, send ) =>\n      return flush send if d is stop\n      return send d if d.$stamped\n      if select d, 'outline:nl'\n        nl_count++\n        position   ?= Interlex.get_token_position d\n        spc_count  ?= d.data.spc_count\n      else\n        flush send\n        send d\n      return null\n\n#===========================================================================================================\n@$030_structure = class $030_structure extends $020_consolidate\n\n  #---------------------------------------------------------------------------------------------------------\n  start = Symbol 'start'\n  stop  = Symbol 'stop'\n\n  #---------------------------------------------------------------------------------------------------------\n  $add_start_and_stop: => $ { start, stop, }, ( d, send ) => send d\n\n  #---------------------------------------------------------------------------------------------------------\n  $mark_indentation_levels: =>\n    { Interlex }  = require '../main'\n    prv_spc_count = 0\n    ref           = '^outliner@030^'\n    $key          = 'outline:dentchg'\n    position      = null\n    return group_indentation_levels = ( d, send ) =>\n      #.....................................................................................................\n      if d is start\n        send start\n        send new_datom $key, { lnr1: 1, x1: 0, lnr2: 1, x2: 0, data: { from: null, to: 0, }, $: ref, }\n        return null\n      #.....................................................................................................\n      if d is stop\n        send new_datom $key, { position..., data: { from: prv_spc_count, to: null, }, $: ref, }\n        send stop\n        return null\n      #.....................................................................................................\n      position = Interlex.get_token_position d\n      if ( spc_count = d.data.spc_count ) isnt prv_spc_count\n        send new_datom $key, { position..., data: { from: prv_spc_count, to: spc_count, }, $: ref, }\n        prv_spc_count = spc_count\n      #.....................................................................................................\n      send d\n      return null\n\n  #---------------------------------------------------------------------------------------------------------\n  $remove_start_and_stop: => ( d, send ) => send d unless ( d is start ) or ( d is stop )\n\n\n#===========================================================================================================\n@$040_blocks = class $040_blocks extends $030_structure\n\n  #---------------------------------------------------------------------------------------------------------\n  $add_block_starts: =>\n    { Interlex }  = require '../main'\n    $key          = 'outline:block:start'\n    ref           = '^outliner@040^'\n    return add_block_starts = $window { min: -1, max: 0, empty: null, }, ( [ prv, d, ], send ) =>\n      return send d unless select d, 'outline:material'\n      return send d unless select prv, 'outline:dentchg', 'outline:nls'\n      data      = { spc_count: d.data.spc_count, }\n      position  = Interlex.get_token_position prv\n      send new_datom $key, { data, position..., $: ref, }\n      send d\n      return null\n\n  #---------------------------------------------------------------------------------------------------------\n  $add_block_stops: =>\n    { Interlex }  = require '../main'\n    $key          = 'outline:block:stop'\n    ref           = '^outliner@040^'\n    return add_block_stops = $window { min: 0, max: +2, empty: null, }, ( [ d, d1, d2, ], send ) =>\n      return send d unless select d, 'outline:material'\n      return send d unless ( select d1, 'outline:nls' ) \\\n                      or ( ( select d1, 'outline:nl'  ) and ( select d2, 'outline:dentchg' ) )\n      send d\n      data      = { spc_count: d.data.spc_count, }\n      position  = Interlex.get_token_position d1\n      send new_datom $key, { data, position..., $: ref, }\n      return null\n\n\n\n\n"
  ]
}